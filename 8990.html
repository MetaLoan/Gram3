<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>AI æ¢è£…ç”Ÿå›¾ - è§’è‰²å®šåˆ¶å™¨</title>
  <style>
    :root {
      --primary: #9d4edd;
      --primary-light: #c77dff;
      --primary-dark: #7b2cbf;
      --secondary: #5a189a;
      --dark: #10002b;
      --card-bg: #240046;
      --text: #e0aaff;
      --light-text: #f8f9fa;
      --highlight: #ff9e00;
      --glow: 0 0 10px var(--primary), 0 0 20px var(--primary-light);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--dark);
      color: var(--light-text);
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(123, 44, 191, 0.2) 0%, transparent 20%),
        radial-gradient(circle at 90% 50%, rgba(157, 78, 221, 0.2) 0%, transparent 25%),
        radial-gradient(circle at 50% 80%, rgba(199, 125, 255, 0.2) 0%, transparent 30%);
      background-attachment: fixed;
      padding: 0;
      margin: 0;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .game-title {
      text-align: center;
      margin: 20px 0;
      font-size: 2.5rem;
      color: var(--light-text);
      text-shadow: 0 0 10px var(--primary), 0 0 20px var(--primary-light);
      letter-spacing: 2px;
    }
    
    .game-subtitle {
      text-align: center;
      margin-bottom: 30px;
      color: var(--text);
      font-size: 1.2rem;
    }
    
    .tab-container {
      display: flex;
      justify-content: center;
      margin-bottom: 30px;
    }
    
    .tab-button {
      background-color: var(--card-bg);
      color: var(--text);
      border: 2px solid var(--primary-dark);
      padding: 12px 25px;
      margin: 0 10px;
      font-size: 1.1rem;
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    
    .tab-button:hover {
      background-color: var(--primary-dark);
      transform: translateY(-3px);
      box-shadow: var(--glow);
    }
    
    .tab-button.active {
      background-color: var(--primary);
      color: var(--light-text);
      box-shadow: var(--glow);
    }
    
    .tabcontent {
      display: none;
      animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .api-key-container {
      background-color: var(--card-bg);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 30px;
      border: 1px solid var(--primary-dark);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .api-key-container label {
      display: block;
      margin-bottom: 10px;
      color: var(--text);
      font-weight: bold;
    }
    
    .api-key-container input {
      width: 100%;
      padding: 12px 15px;
      border-radius: 8px;
      border: 1px solid var(--primary-dark);
      background-color: rgba(16, 0, 43, 0.7);
      color: var(--light-text);
      font-size: 1rem;
    }
    
    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .option-card {
      background-color: var(--card-bg);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      border: 1px solid var(--primary-dark);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .option-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--glow);
    }
    
    .option-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(
        45deg,
        transparent,
        rgba(157, 78, 221, 0.1),
        transparent
      );
      transform: rotate(45deg);
      transition: all 0.5s ease;
      z-index: 0;
    }
    
    .option-card:hover::before {
      animation: shine 1.5s infinite;
    }
    
    @keyframes shine {
      0% {
        transform: translateX(-100%) rotate(45deg);
      }
      100% {
        transform: translateX(100%) rotate(45deg);
      }
    }
    
    .card-title {
      color: var(--primary-light);
      font-size: 1.3rem;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      position: relative;
      z-index: 1;
    }
    
    .card-title i {
      margin-right: 10px;
      font-size: 1.5rem;
    }
    
    .option-card label {
      display: block;
      margin: 10px 0 5px;
      color: var(--text);
      font-weight: 500;
      position: relative;
      z-index: 1;
    }
    
    .option-card select,
    .option-card input,
    .option-card textarea {
      width: 100%;
      padding: 10px 15px;
      border-radius: 8px;
      border: 1px solid var(--primary-dark);
      background-color: rgba(16, 0, 43, 0.7);
      color: var(--light-text);
      font-size: 0.95rem;
      position: relative;
      z-index: 1;
    }
    
    .option-card select:focus,
    .option-card input:focus,
    .option-card textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(157, 78, 221, 0.3);
    }
    
    .avatar-card {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .avatar-preview {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      object-fit: cover;
      margin: 15px 0;
      border: 3px solid var(--primary);
      box-shadow: var(--glow);
    }
    
    .avatar-upload {
      margin: 10px 0;
    }
    
    .clear-avatar-btn {
      background-color: rgba(255, 158, 0, 0.2);
      color: var(--highlight);
      border: 1px solid var(--highlight);
      padding: 8px 15px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }
    
    .clear-avatar-btn:hover {
      background-color: var(--highlight);
      color: var(--dark);
    }
    
    .generate-btn {
      display: block;
      width: 100%;
      max-width: 300px;
      margin: 30px auto;
      padding: 15px 30px;
      background: linear-gradient(45deg, var(--primary-dark), var(--primary));
      color: var(--light-text);
      border: none;
      border-radius: 30px;
      font-size: 1.2rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .generate-btn::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(
        45deg,
        transparent,
        rgba(255, 255, 255, 0.2),
        transparent
      );
      transform: rotate(45deg);
      transition: all 0.5s ease;
    }
    
    .generate-btn:hover {
      transform: translateY(-5px);
      box-shadow: var(--glow);
    }
    
    .generate-btn:hover::before {
      animation: shine 1.5s infinite;
    }
    
    .output-container {
      background-color: var(--card-bg);
      border-radius: 15px;
      padding: 20px;
      margin: 30px 0;
      border: 1px solid var(--primary-dark);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      min-height: 300px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .output-container img {
      max-width: 100%;
      max-height: 500px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
    }
    
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .loading {
      width: 80px;
      height: 80px;
      border: 4px solid rgba(157, 78, 221, 0.3);
      border-radius: 50%;
      border-top: 4px solid var(--primary);
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-text {
      margin-top: 20px;
      color: var(--text);
      font-size: 1.1rem;
    }
    
    .debug-container {
      background-color: rgba(16, 0, 43, 0.7);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid var(--primary-dark);
      overflow-x: auto;
    }
    
    .debug-container h3 {
      color: var(--primary-light);
      margin-bottom: 10px;
    }
    
    .debug-content {
      font-family: monospace;
      white-space: pre-wrap;
      color: var(--text);
      font-size: 0.9rem;
    }
    
    .history-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
    }
    
    .history-card {
      background-color: var(--card-bg);
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .history-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--glow);
    }
    
    .history-image {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }
    
    .history-info {
      padding: 15px;
    }
    
    .history-timestamp {
      color: var(--text);
      font-size: 0.8rem;
      margin-bottom: 5px;
    }
    
    .history-details {
      color: var(--light-text);
      font-size: 0.9rem;
    }
    
    /* å¡ç‰Œé€‰æ‹©æ•ˆæœ */
    .card-options {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }
    
    .option-item {
      background-color: rgba(16, 0, 43, 0.7);
      border: 1px solid var(--primary-dark);
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .option-item:hover {
      background-color: var(--primary-dark);
      transform: translateY(-3px);
    }
    
    .option-item.selected {
      background-color: var(--primary);
      border-color: var(--primary-light);
      box-shadow: 0 0 10px var(--primary);
    }
    
    .option-item-icon {
      font-size: 1.5rem;
      margin-bottom: 5px;
    }
    
    .option-item-text {
      font-size: 0.8rem;
    }
    
    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 768px) {
      .card-grid {
        grid-template-columns: 1fr;
      }
      
      .game-title {
        font-size: 1.8rem;
      }
      
      .tab-button {
        padding: 10px 15px;
        font-size: 0.9rem;
      }
    }
    
    /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--dark);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--primary-dark);
      border-radius: 5px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary);
    }
  </style>
  <!-- æ·»åŠ Font Awesomeå›¾æ ‡åº“ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <h1 class="game-title">AI è§’è‰²å®šåˆ¶å™¨</h1>
    <p class="game-subtitle">åˆ›é€ ä½ çš„ä¸“å±è§’è‰²ï¼Œæ¢ç´¢æ— é™å¯èƒ½</p>
    
    <div class="tab-container">
      <button class="tab-button active" onclick="openTab('creatorTab')">
        <i class="fas fa-magic"></i> è§’è‰²åˆ›é€ 
      </button>
      <button class="tab-button" onclick="openTab('galleryTab')">
        <i class="fas fa-images"></i> è§’è‰²ç”»å»Š
      </button>
    </div>
    
    <div id="creatorTab" class="tabcontent" style="display: block;">
      <div class="api-key-container">
        <label for="apikey"><i class="fas fa-key"></i> APIå¯†é’¥</label>
        <input type="password" id="apikey" placeholder="è¾“å…¥ä½ çš„APIå¯†é’¥ä»¥å¼€å§‹åˆ›ä½œ..." />
      </div>
      
      <div class="card-grid">
        <div class="option-card avatar-card">
          <h3 class="card-title"><i class="fas fa-user-circle"></i> å¤´åƒä¸Šä¼ </h3>
          <img id="avatarPreview" class="avatar-preview" src="https://via.placeholder.com/150/240046/e0aaff?text=ä¸Šä¼ å¤´åƒ" alt="å¤´åƒé¢„è§ˆ" />
          <input type="file" id="avatarUpload" class="avatar-upload" accept="image/*" onchange="previewAvatar()" />
          <button class="clear-avatar-btn" onclick="clearAvatar()">æ¸…é™¤å¤´åƒ</button>
        </div>
        
        <div class="option-card">
          <h3 class="card-title"><i class="fas fa-venus-mars"></i> åŸºæœ¬å±æ€§</h3>
          <label>æ€§åˆ«</label>
          <div class="card-options" id="genderOptions">
            <div class="option-item selected" data-value="ç”·æ€§" onclick="selectOption(this, 'gender')">
              <div class="option-item-icon"><i class="fas fa-male"></i></div>
              <div class="option-item-text">ç”·æ€§</div>
            </div>
            <div class="option-item" data-value="å¥³æ€§" onclick="selectOption(this, 'gender')">
              <div class="option-item-icon"><i class="fas fa-female"></i></div>
              <div class="option-item-text">å¥³æ€§</div>
            </div>
            <div class="option-item" data-value="ä¸­æ€§" onclick="selectOption(this, 'gender')">
              <div class="option-item-icon"><i class="fas fa-genderless"></i></div>
              <div class="option-item-text">ä¸­æ€§</div>
            </div>
          </div>
          
          <label>è‰ºæœ¯é£æ ¼</label>
          <div class="card-options" id="styleOptions">
            <div class="option-item selected" data-value="å†™å®é£æ ¼" onclick="selectOption(this, 'style')">
              <div class="option-item-icon"><i class="fas fa-portrait"></i></div>
              <div class="option-item-text">å†™å®</div>
            </div>
            <div class="option-item" data-value="å¡é€šé£æ ¼" onclick="selectOption(this, 'style')">
              <div class="option-item-icon"><i class="fas fa-smile"></i></div>
              <div class="option-item-text">å¡é€š</div>
            </div>
            <div class="option-item" data-value="åŠ¨æ¼«é£æ ¼" onclick="selectOption(this, 'style')">
              <div class="option-item-icon"><i class="fas fa-fire"></i></div>
              <div class="option-item-text">åŠ¨æ¼«</div>
            </div>
            <div class="option-item" data-value="èµ›åšæœ‹å…‹" onclick="selectOption(this, 'style')">
              <div class="option-item-icon"><i class="fas fa-robot"></i></div>
              <div class="option-item-text">èµ›åšæœ‹å…‹</div>
            </div>
          </div>
        </div>
        
        <div class="option-card">
          <h3 class="card-title"><i class="fas fa-tshirt"></i> ç€è£…é€‰æ‹©</h3>
          <label>æœè£…ç±»å‹</label>
          <div class="card-options" id="clothingOptions">
            <div class="option-item selected" data-value="ä¼‘é—²è£…" onclick="selectOption(this, 'clothing')">
              <div class="option-item-icon"><i class="fas fa-tshirt"></i></div>
              <div class="option-item-text">ä¼‘é—²è£…</div>
            </div>
            <div class="option-item" data-value="æ­£è£…è¥¿æœ" onclick="selectOption(this, 'clothing')">
              <div class="option-item-icon"><i class="fas fa-user-tie"></i></div>
              <div class="option-item-text">æ­£è£…</div>
            </div>
            <div class="option-item" data-value="è¿åŠ¨è£…" onclick="selectOption(this, 'clothing')">
              <div class="option-item-icon"><i class="fas fa-running"></i></div>
              <div class="option-item-text">è¿åŠ¨è£…</div>
            </div>
            <div class="option-item" data-value="å¥‡å¹»æœè£…" onclick="selectOption(this, 'clothing')">
              <div class="option-item-icon"><i class="fas fa-hat-wizard"></i></div>
              <div class="option-item-text">å¥‡å¹»</div>
            </div>
          </div>
          
          <label>æœè£…é¢œè‰²</label>
          <div class="card-options" id="colorOptions">
            <div class="option-item selected" data-value="çº¢è‰²" onclick="selectOption(this, 'clothingColor')" style="background-color: rgba(220, 53, 69, 0.3);">
              <div class="option-item-text">çº¢è‰²</div>
            </div>
            <div class="option-item" data-value="è“è‰²" onclick="selectOption(this, 'clothingColor')" style="background-color: rgba(13, 110, 253, 0.3);">
              <div class="option-item-text">è“è‰²</div>
            </div>
            <div class="option-item" data-value="ç»¿è‰²" onclick="selectOption(this, 'clothingColor')" style="background-color: rgba(25, 135, 84, 0.3);">
              <div class="option-item-text">ç»¿è‰²</div>
            </div>
            <div class="option-item" data-value="é»‘è‰²" onclick="selectOption(this, 'clothingColor')" style="background-color: rgba(33, 37, 41, 0.3);">
              <div class="option-item-text">é»‘è‰²</div>
            </div>
            <div class="option-item" data-value="ç´«è‰²" onclick="selectOption(this, 'clothingColor')" style="background-color: rgba(111, 66, 193, 0.3);">
              <div class="option-item-text">ç´«è‰²</div>
            </div>
          </div>
          
          <label>æœè£…ç»†èŠ‚</label>
          <input type="text" id="clothingDetail" placeholder="æ·»åŠ æœè£…ç»†èŠ‚ï¼Œå¦‚èŠ±çº¹ã€å¾½ç« ç­‰..." />
        </div>
        
        <div class="option-card">
          <h3 class="card-title"><i class="fas fa-mountain"></i> ç¯å¢ƒè®¾ç½®</h3>
          <label>åœºæ™¯ç¯å¢ƒ</label>
          <div class="card-options" id="environmentOptions">
            <div class="option-item selected" data-value="åŸå¸‚è¡—é“" onclick="selectOption(this, 'environment')">
              <div class="option-item-icon"><i class="fas fa-city"></i></div>
              <div class="option-item-text">åŸå¸‚</div>
            </div>
            <div class="option-item" data-value="è‡ªç„¶é£æ™¯" onclick="selectOption(this, 'environment')">
              <div class="option-item-icon"><i class="fas fa-tree"></i></div>
              <div class="option-item-text">è‡ªç„¶</div>
            </div>
            <div class="option-item" data-value="ç§‘å¹»åœºæ™¯" onclick="selectOption(this, 'environment')">
              <div class="option-item-icon"><i class="fas fa-space-shuttle"></i></div>
              <div class="option-item-text">ç§‘å¹»</div>
            </div>
            <div class="option-item" data-value="å¥‡å¹»ä¸–ç•Œ" onclick="selectOption(this, 'environment')">
              <div class="option-item-icon"><i class="fas fa-dragon"></i></div>
              <div class="option-item-text">å¥‡å¹»</div>
            </div>
          </div>
          
          <label>æ—¶é—´</label>
          <div class="card-options" id="timeOptions">
            <div class="option-item selected" data-value="ç™½å¤©" onclick="selectOption(this, 'timeOfDay')">
              <div class="option-item-icon"><i class="fas fa-sun"></i></div>
              <div class="option-item-text">ç™½å¤©</div>
            </div>
            <div class="option-item" data-value="é»„æ˜" onclick="selectOption(this, 'timeOfDay')">
              <div class="option-item-icon"><i class="fas fa-cloud-sun"></i></div>
              <div class="option-item-text">é»„æ˜</div>
            </div>
            <div class="option-item" data-value="å¤œæ™š" onclick="selectOption(this, 'timeOfDay')">
              <div class="option-item-icon"><i class="fas fa-moon"></i></div>
              <div class="option-item-text">å¤œæ™š</div>
            </div>
          </div>
          
          <label>å¤©æ°”</label>
          <div class="card-options" id="weatherOptions">
            <div class="option-item selected" data-value="æ™´æœ—" onclick="selectOption(this, 'weather')">
              <div class="option-item-icon"><i class="fas fa-sun"></i></div>
              <div class="option-item-text">æ™´æœ—</div>
            </div>
            <div class="option-item" data-value="é›¨å¤©" onclick="selectOption(this, 'weather')">
              <div class="option-item-icon"><i class="fas fa-cloud-rain"></i></div>
              <div class="option-item-text">é›¨å¤©</div>
            </div>
            <div class="option-item" data-value="é›ªå¤©" onclick="selectOption(this, 'weather')">
              <div class="option-item-icon"><i class="fas fa-snowflake"></i></div>
              <div class="option-item-text">é›ªå¤©</div>
            </div>
          </div>
        </div>
        
        <div class="option-card">
          <h3 class="card-title"><i class="fas fa-running"></i> åŠ¨ä½œå§¿åŠ¿</h3>
          <label>åŠ¨ä½œ</label>
          <div class="card-options" id="poseOptions">
            <div class="option-item selected" data-value="ç«™ç«‹" onclick="selectOption(this, 'pose')">
              <div class="option-item-icon"><i class="fas fa-male"></i></div>
              <div class="option-item-text">ç«™ç«‹</div>
            </div>
            <div class="option-item" data-value="è¡Œèµ°" onclick="selectOption(this, 'pose')">
              <div class="option-item-icon"><i class="fas fa-walking"></i></div>
              <div class="option-item-text">è¡Œèµ°</div>
            </div>
            <div class="option-item" data-value="è·‘æ­¥" onclick="selectOption(this, 'pose')">
              <div class="option-item-icon"><i class="fas fa-running"></i></div>
              <div class="option-item-text">è·‘æ­¥</div>
            </div>
            <div class="option-item" data-value="æˆ˜æ–—å§¿åŠ¿" onclick="selectOption(this, 'pose')">
              <div class="option-item-icon"><i class="fas fa-fist-raised"></i></div>
              <div class="option-item-text">æˆ˜æ–—</div>
            </div>
          </div>
          
          <label>è¡¨æƒ…</label>
          <div class="card-options" id="expressionOptions">
            <div class="option-item selected" data-value="å¾®ç¬‘" onclick="selectOption(this, 'expression')">
              <div class="option-item-icon"><i class="fas fa-smile"></i></div>
              <div class="option-item-text">å¾®ç¬‘</div>
            </div>
            <div class="option-item" data-value="ä¸¥è‚ƒ" onclick="selectOption(this, 'expression')">
              <div class="option-item-icon"><i class="fas fa-meh"></i></div>
              <div class="option-item-text">ä¸¥è‚ƒ</div>
            </div>
            <div class="option-item" data-value="æƒŠè®¶" onclick="selectOption(this, 'expression')">
              <div class="option-item-icon"><i class="fas fa-surprise"></i></div>
              <div class="option-item-text">æƒŠè®¶</div>
            </div>
            <div class="option-item" data-value="æ„¤æ€’" onclick="selectOption(this, 'expression')">
              <div class="option-item-icon"><i class="fas fa-angry"></i></div>
              <div class="option-item-text">æ„¤æ€’</div>
            </div>
          </div>
        </div>
        
        <div class="option-card">
          <h3 class="card-title"><i class="fas fa-gamepad"></i> é“å…·é€‰æ‹©          </h3>
          <label>ä¸»è¦é“å…·</label>
          <div class="card-options" id="prop1Options">
            <div class="option-item selected" data-value="æ— " onclick="selectOption(this, 'prop1')">
              <div class="option-item-icon"><i class="fas fa-times-circle"></i></div>
              <div class="option-item-text">æ— </div>
            </div>
            <div class="option-item" data-value="æ‰‹æœº" onclick="selectOption(this, 'prop1')">
              <div class="option-item-icon"><i class="fas fa-mobile-alt"></i></div>
              <div class="option-item-text">æ‰‹æœº</div>
            </div>
            <div class="option-item" data-value="ä¹¦æœ¬" onclick="selectOption(this, 'prop1')">
              <div class="option-item-icon"><i class="fas fa-book"></i></div>
              <div class="option-item-text">ä¹¦æœ¬</div>
            </div>
            <div class="option-item" data-value="æ­¦å™¨" onclick="selectOption(this, 'prop1')">
              <div class="option-item-icon"><i class="fas fa-sword"></i></div>
              <div class="option-item-text">æ­¦å™¨</div>
            </div>
          </div>
          
          <label>æ¬¡è¦é“å…·</label>
          <div class="card-options" id="prop2Options">
            <div class="option-item selected" data-value="æ— " onclick="selectOption(this, 'prop2')">
              <div class="option-item-icon"><i class="fas fa-times-circle"></i></div>
              <div class="option-item-text">æ— </div>
            </div>
            <div class="option-item" data-value="çœ¼é•œ" onclick="selectOption(this, 'prop2')">
              <div class="option-item-icon"><i class="fas fa-glasses"></i></div>
              <div class="option-item-text">çœ¼é•œ</div>
            </div>
            <div class="option-item" data-value="å¸½å­" onclick="selectOption(this, 'prop2')">
              <div class="option-item-icon"><i class="fas fa-hat-cowboy"></i></div>
              <div class="option-item-text">å¸½å­</div>
            </div>
            <div class="option-item" data-value="é¡¹é“¾" onclick="selectOption(this, 'prop2')">
              <div class="option-item-icon"><i class="fas fa-gem"></i></div>
              <div class="option-item-text">é¡¹é“¾</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="option-card">
        <h3 class="card-title"><i class="fas fa-edit"></i> é¢å¤–ç»†èŠ‚</h3>
        <textarea id="additionalDetails" placeholder="æ·»åŠ ä»»ä½•ä½ æƒ³è¦çš„é¢å¤–ç»†èŠ‚æè¿°..." rows="3"></textarea>
      </div>
      
      <button class="generate-btn" onclick="generateImage()">
        <i class="fas fa-magic"></i> ç”Ÿæˆæˆ‘çš„è§’è‰²
      </button>
      
      <div class="output-container" id="output">
        <i class="fas fa-image" style="font-size: 3rem; color: var(--primary-light); margin-bottom: 15px;"></i>
        <p>ä½ çš„è§’è‰²å°†åœ¨è¿™é‡Œæ˜¾ç¤º</p>
      </div>
      
      <div class="debug-container">
        <h3><i class="fas fa-bug"></i> è°ƒè¯•ä¿¡æ¯</h3>
        <div class="debug-content" id="debug">ç­‰å¾…ç”Ÿæˆ...</div>
      </div>
    </div>
    
    <div id="galleryTab" class="tabcontent">
      <h3 class="card-title" style="margin-bottom: 20px;"><i class="fas fa-history"></i> å†å²åˆ›ä½œ</h3>
      <div class="history-grid" id="historyContainer">
        <!-- å†å²è®°å½•å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        <p>æš‚æ— å†å²è®°å½•</p>
      </div>
    </div>
  </div>

  <script>
    // å­˜å‚¨æ‰€æœ‰é€‰é¡¹çš„å½“å‰å€¼
    const selectedOptions = {
      gender: 'ç”·æ€§',
      style: 'å†™å®é£æ ¼',
      clothing: 'ä¼‘é—²è£…',
      clothingColor: 'çº¢è‰²',
      environment: 'åŸå¸‚è¡—é“',
      timeOfDay: 'ç™½å¤©',
      weather: 'æ™´æœ—',
      pose: 'ç«™ç«‹',
      expression: 'å¾®ç¬‘',
      prop1: 'æ— ',
      prop2: 'æ— '
    };
    
    // ä½¿ç”¨ ChatAnywhere çš„å›½å†…è½¬å‘åœ°å€
    const API_URL_TEXT = "https://api.chatanywhere.tech/v1/chat/completions";
    const API_URL_IMAGE = "https://api.chatanywhere.tech/v1/images/generations";
    const API_URL_IMAGE_EDIT = "https://api.chatanywhere.tech/v1/images/edits";

    // å­˜å‚¨å†å²è®°å½•
    let generationHistory = JSON.parse(localStorage.getItem('imageHistory')) || [];
    
    // å¤´åƒç›¸å…³å˜é‡
    let avatarFile = null;
    let avatarBase64 = null;

    // é€‰æ‹©é€‰é¡¹
    function selectOption(element, optionType) {
      // ç§»é™¤åŒç»„ä¸­æ‰€æœ‰é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
      const options = document.querySelectorAll(`#${optionType}Options .option-item`);
      options.forEach(option => {
        option.classList.remove('selected');
      });
      
      // æ·»åŠ é€‰ä¸­çŠ¶æ€åˆ°å½“å‰é€‰é¡¹
      element.classList.add('selected');
      
      // æ›´æ–°é€‰ä¸­çš„å€¼
      selectedOptions[optionType] = element.getAttribute('data-value');
      
      // æ·»åŠ é€‰æ‹©åŠ¨ç”»æ•ˆæœ
      element.style.animation = 'none';
      setTimeout(() => {
        element.style.animation = 'pulse 0.5s';
      }, 10);
    }

    // é¢„è§ˆä¸Šä¼ çš„å¤´åƒ
    function previewAvatar() {
      const fileInput = document.getElementById('avatarUpload');
      const preview = document.getElementById('avatarPreview');
      
      if (fileInput.files && fileInput.files[0]) {
        avatarFile = fileInput.files[0];
        const reader = new FileReader();
        
        reader.onload = function(e) {
          preview.src = e.target.result;
          avatarBase64 = e.target.result;
        }
        
        reader.readAsDataURL(avatarFile);
      }
    }
    
    // æ¸…é™¤å¤´åƒ
    function clearAvatar() {
      document.getElementById('avatarUpload').value = '';
      document.getElementById('avatarPreview').src = 'https://via.placeholder.com/150/240046/e0aaff?text=ä¸Šä¼ å¤´åƒ';
      avatarFile = null;
      avatarBase64 = null;
    }

    // ç”Ÿæˆæç¤ºè¯
    function generatePrompt() {
      const clothingDetail = document.getElementById('clothingDetail').value;
      const additionalDetails = document.getElementById('additionalDetails').value;

      let prompt = `ä¸€ä¸ª${selectedOptions.gender}è§’è‰²ï¼Œç©¿ç€${selectedOptions.clothingColor}${selectedOptions.clothing}`;
      
      if (clothingDetail) {
        prompt += `ï¼Œ${clothingDetail}`;
      }
      
      prompt += `ï¼Œåœ¨${selectedOptions.timeOfDay}${selectedOptions.weather}çš„${selectedOptions.environment}ä¸­${selectedOptions.pose}`;
      
      if (selectedOptions.expression) {
        prompt += `ï¼Œè¡¨æƒ…${selectedOptions.expression}`;
      }
      
      if (selectedOptions.prop1 !== 'æ— ') {
        prompt += `ï¼Œæ‰‹æŒ${selectedOptions.prop1}`;
      }
      
      if (selectedOptions.prop2 !== 'æ— ') {
        prompt += `ï¼Œä½©æˆ´ç€${selectedOptions.prop2}`;
      }
      
      prompt += `ï¼Œ${selectedOptions.style}`;
      
      if (additionalDetails) {
        prompt += `ï¼Œ${additionalDetails}`;
      }
      
      prompt += 'ï¼Œé«˜è´¨é‡ï¼Œç»†èŠ‚ä¸°å¯Œï¼Œ4K';
      
      return prompt;
    }

    // ç”Ÿæˆå›¾åƒ
    async function generateImage() {
      const apiKey = document.getElementById('apikey').value.trim();
      const output = document.getElementById('output');
      const debug = document.getElementById('debug');
      
      if (!apiKey) {
        output.innerHTML = `
          <div style="color: var(--highlight); text-align: center;">
            <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 15px;"></i>
            <p>è¯·å…ˆå¡«å†™APIå¯†é’¥</p>
          </div>
        `;
        return;
      }
      
      const prompt = generatePrompt();
      
      // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
      output.innerHTML = `
        <div class="loading-container">
          <div class="loading"></div>
          <div class="loading-text">æ­£åœ¨åˆ›é€ ä½ çš„è§’è‰²ï¼Œè¯·ç¨å€™...</div>
        </div>
      `;
      
      debug.innerText = 'ğŸ” æ­£åœ¨å‡†å¤‡è¯·æ±‚...';
      
      try {
        let url = '';
        let body = {};
        let formData = null;
        let headers = {
          'Authorization': `Bearer ${apiKey}`
        };
        
        // åˆ¤æ–­æ˜¯å¦ä½¿ç”¨å›¾ç”Ÿå›¾æ¨¡å¼
        if (avatarFile) {
          url = API_URL_IMAGE_EDIT;
          formData = new FormData();
          formData.append('image', avatarFile);
          formData.append('prompt', prompt);
          formData.append('n', 1);
          formData.append('size', '1024x1024');
          formData.append('response_format', 'b64_json'); // ç¡®ä¿è¿”å›base64æ ¼å¼
          
          debug.innerText = `ğŸ”— è¯·æ±‚åœ°å€ï¼š${url}\n\nğŸ“¤ è¯·æ±‚ä½“ï¼šå›¾ç”Ÿå›¾æ¨¡å¼ï¼Œä¸Šä¼ å¤´åƒ + "${prompt}"`;
        } else {
          url = API_URL_IMAGE;
          body = {
            prompt: prompt,
            n: 1,
            size: "1024x1024",
            response_format: "b64_json" // ç¡®ä¿è¿”å›base64æ ¼å¼
          };
          
          headers['Content-Type'] = 'application/json';
          debug.innerText = `ğŸ”— è¯·æ±‚åœ°å€ï¼š${url}\n\nğŸ“¤ è¯·æ±‚ä½“ï¼š\n${JSON.stringify(body, null, 2)}`;
        }
        
        let response;
        
        if (formData) {
          response = await fetch(url, {
            method: 'POST',
            headers: headers,
            body: formData
          });
        } else {
          response = await fetch(url, {
            method: 'POST',
            headers: headers,
            body: JSON.stringify(body)
          });
        }
        
        const data = await response.json();
        
        if (data.error) {
          output.innerHTML = `
            <div style="color: var(--highlight); text-align: center;">
              <i class="fas fa-exclamation-circle" style="font-size: 2rem; margin-bottom: 15px;"></i>
              <p>ç”Ÿæˆå¤±è´¥ï¼š${data.error.message || 'æœªçŸ¥é”™è¯¯'}</p>
            </div>
          `;
          debug.innerText += `\n\nğŸ“¥ è¿”å›é”™è¯¯ï¼š\n${JSON.stringify(data, null, 2)}`;
        } else {
          // å¤„ç†è¿”å›çš„base64å›¾åƒæ•°æ®
          const b64Image = data.data?.[0]?.b64_json;
          
          if (b64Image) {
            // åˆ›å»ºå›¾åƒURL
            const imageUrl = `data:image/png;base64,${b64Image}`;
            output.innerHTML = `
              <div style="text-align: center;">
                <img src="${imageUrl}" alt="ç”Ÿæˆè§’è‰²" />
                <p style="margin-top: 15px; color: var(--text);">âœ¨ è§’è‰²ç”ŸæˆæˆåŠŸ! âœ¨</p>
              </div>
            `;
            
            // ä¿å­˜åˆ°å†å²è®°å½•
            const timestamp = new Date().toLocaleString();
            const historyItem = {
              id: Date.now(),
              imageUrl: imageUrl, // ä¿å­˜base64å›¾åƒ
              prompt: prompt,
              timestamp: timestamp,
              settings: {
                gender: selectedOptions.gender,
                clothing: selectedOptions.clothing,
                environment: selectedOptions.environment,
                pose: selectedOptions.pose,
                style: selectedOptions.style
              }
            };
            
            generationHistory.unshift(historyItem);
            if (generationHistory.length > 50) generationHistory.pop(); // é™åˆ¶å†å²è®°å½•æ•°é‡
            localStorage.setItem('imageHistory', JSON.stringify(generationHistory));
            updateHistoryDisplay();
          } else {
            output.innerHTML = `
              <div style="color: var(--highlight); text-align: center;">
                <i class="fas fa-exclamation-circle" style="font-size: 2rem; margin-bottom: 15px;"></i>
                <p>å›¾åƒç”Ÿæˆå¤±è´¥ - æœªæ”¶åˆ°æœ‰æ•ˆçš„å›¾åƒæ•°æ®</p>
              </div>
            `;
          }
          
          // é™åˆ¶è°ƒè¯•ä¿¡æ¯é•¿åº¦ï¼Œé¿å…æ˜¾ç¤ºå¤ªé•¿çš„base64å­—ç¬¦ä¸²
          let debugData = JSON.parse(JSON.stringify(data));
          if (debugData.data && debugData.data[0] && debugData.data[0].b64_json) {
            debugData.data[0].b64_json = debugData.data[0].b64_json.substring(0, 100) + '... [æˆªæ–­]';
          }
          debug.innerText += `\n\nğŸ“¥ è¿”å›å†…å®¹ï¼š\n${JSON.stringify(debugData, null, 2)}`;
        }
      } catch (err) {
        output.innerHTML = `
          <div style="color: var(--highlight); text-align: center;">
            <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 15px;"></i>
            <p>è¯·æ±‚å¤±è´¥ï¼š${err.message}</p>
          </div>
        `;
        debug.innerText += `\n\nâ— é”™è¯¯ä¿¡æ¯ï¼š${err.message}`;
      }
    }
    
    // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
    function updateHistoryDisplay() {
      const container = document.getElementById('historyContainer');
      
      if (generationHistory.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; grid-column: 1 / -1; padding: 30px;">
            <i class="fas fa-photo-video" style="font-size: 3rem; color: var(--primary-light); margin-bottom: 15px;"></i>
            <p>æš‚æ— å†å²è®°å½•</p>
            <p style="font-size: 0.9rem; margin-top: 10px; color: var(--text);">ç”Ÿæˆä½ çš„ç¬¬ä¸€ä¸ªè§’è‰²æ¥å¼€å§‹æ”¶é›†!</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = '';
      
      generationHistory.forEach(item => {
        const historyCard = document.createElement('div');
        historyCard.className = 'history-card';
        historyCard.innerHTML = `
          <img src="${item.imageUrl}" class="history-image" alt="å†å²è§’è‰²" />
          <div class="history-info">
            <div class="history-timestamp">${item.timestamp}</div>
            <div class="history-details">${item.settings.gender} | ${item.settings.style}</div>
          </div>
        `;
        
        historyCard.addEventListener('click', () => {
          document.getElementById('output').innerHTML = `
            <div style="text-align: center;">
              <img src="${item.imageUrl}" alt="å†å²è§’è‰²" />
              <p style="margin-top: 15px; color: var(--text);">ä»å†å²è®°å½•åŠ è½½</p>
            </div>
          `;
          document.getElementById('debug').innerText = `ä»å†å²è®°å½•åŠ è½½ï¼š\n${item.prompt}`;
          
          // åˆ‡æ¢åˆ°åˆ›å»ºå™¨æ ‡ç­¾
          openTab('creatorTab');
        });
        
        container.appendChild(historyCard);
      });
    }
    
    // æ ‡ç­¾é¡µåˆ‡æ¢åŠŸèƒ½
    function openTab(tabName) {
      const tabcontent = document.getElementsByClassName('tabcontent');
      for (let i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = 'none';
      }
      
      const tablinks = document.getElementsByClassName('tab-button');
      for (let i = 0; i < tablinks.length; i++) {
        tablinks[i].classList.remove('active');
      }
      
      document.getElementById(tabName).style.display = 'block';
      
      // æ‰¾åˆ°å¯¹åº”çš„æŒ‰é’®å¹¶æ·»åŠ activeç±»
      const buttons = document.querySelectorAll('.tab-button');
      buttons.forEach(button => {
        if (button.getAttribute('onclick').includes(tabName)) {
          button.classList.add('active');
        }
      });
      
      if (tabName === 'galleryTab') {
        updateHistoryDisplay();
      }
    }
    
    // æ·»åŠ è„‰å†²åŠ¨ç”»
    document.head.insertAdjacentHTML('beforeend', `
      <style>
        @keyframes pulse {
          0% { transform: scale(1); }
          50% { transform: scale(1.05); }
          100% { transform: scale(1); }
        }
      </style>
    `);
    
    // åˆå§‹åŒ–
    updateHistoryDisplay();
  </script>
</body>
</html>
