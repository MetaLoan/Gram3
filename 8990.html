<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é«˜çº§ç½‘é¡µçˆ¬è™«å·¥å…·</title>
  <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          min-height: 100vh;
          padding: 20px;
      }

      .container {
          max-width: 1400px;
          margin: 0 auto;
          background: white;
          border-radius: 15px;
          box-shadow: 0 20px 40px rgba(0,0,0,0.1);
          overflow: hidden;
      }

      .header {
          background: linear-gradient(135deg, #2c3e50, #3498db);
          color: white;
          padding: 30px;
          text-align: center;
      }

      .header h1 {
          font-size: 2.5em;
          margin-bottom: 10px;
      }

      .header p {
          opacity: 0.9;
          font-size: 1.1em;
      }

      .main-content {
          padding: 30px;
      }

      .input-section {
          background: #f8f9fa;
          padding: 25px;
          border-radius: 10px;
          margin-bottom: 30px;
      }

      .form-group {
          margin-bottom: 20px;
      }

      label {
          display: block;
          margin-bottom: 8px;
          font-weight: 600;
          color: #2c3e50;
      }

      input, select, textarea {
          width: 100%;
          padding: 12px;
          border: 2px solid #e0e6ed;
          border-radius: 8px;
          font-size: 16px;
          transition: border-color 0.3s;
      }

      input:focus, select:focus, textarea:focus {
          outline: none;
          border-color: #3498db;
      }

      .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 20px;
      }

      .form-row-3 {
          display: grid;
          grid-template-columns: 1fr 1fr 1fr;
          gap: 20px;
      }

      .checkbox-group {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 15px;
          margin-top: 10px;
      }

      .checkbox-item {
          display: flex;
          align-items: center;
          gap: 8px;
      }

      .checkbox-item input[type="checkbox"] {
          width: auto;
          margin: 0;
      }

      .btn {
          background: linear-gradient(135deg, #3498db, #2980b9);
          color: white;
          border: none;
          padding: 15px 30px;
          border-radius: 8px;
          font-size: 16px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s;
          margin-right: 10px;
          margin-bottom: 10px;
      }

      .btn:hover {
          transform: translateY(-2px);
          box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
      }

      .btn:disabled {
          background: #bdc3c7;
          cursor: not-allowed;
          transform: none;
          box-shadow: none;
      }

      .btn-secondary {
          background: linear-gradient(135deg, #95a5a6, #7f8c8d);
      }

      .btn-danger {
          background: linear-gradient(135deg, #e74c3c, #c0392b);
      }

      .btn-success {
          background: linear-gradient(135deg, #27ae60, #229954);
      }

      .btn-warning {
          background: linear-gradient(135deg, #f39c12, #e67e22);
      }

      .results-section {
          background: #f8f9fa;
          border-radius: 10px;
          padding: 25px;
          margin-top: 30px;
      }

      .status {
          padding: 15px;
          border-radius: 8px;
          margin-bottom: 20px;
          font-weight: 600;
      }

      .status.loading {
          background: #fff3cd;
          color: #856404;
          border: 1px solid #ffeaa7;
      }

      .status.success {
          background: #d4edda;
          color: #155724;
          border: 1px solid #c3e6cb;
      }

      .status.error {
          background: #f8d7da;
          color: #721c24;
          border: 1px solid #f5c6cb;
      }

      .status.paused {
          background: #e2e3e5;
          color: #383d41;
          border: 1px solid #d6d8db;
      }

      .progress-container {
          margin: 20px 0;
      }

      .progress-bar {
          width: 100%;
          height: 8px;
          background: #e0e6ed;
          border-radius: 4px;
          overflow: hidden;
          margin: 10px 0;
      }

      .progress-fill {
          height: 100%;
          background: linear-gradient(90deg, #3498db, #2980b9);
          width: 0%;
          transition: width 0.3s;
      }

      .progress-text {
          display: flex;
          justify-content: space-between;
          font-size: 14px;
          color: #7f8c8d;
      }

      .stats {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
          gap: 20px;
          margin: 20px 0;
      }

      .stat-card {
          background: white;
          padding: 20px;
          border-radius: 8px;
          text-align: center;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }

      .stat-number {
          font-size: 2em;
          font-weight: bold;
          color: #3498db;
      }

      .stat-label {
          color: #7f8c8d;
          margin-top: 5px;
      }

      .data-preview {
          background: white;
          border: 1px solid #dee2e6;
          border-radius: 8px;
          max-height: 500px;
          overflow: auto;
          margin-top: 20px;
      }

      .data-table {
          width: 100%;
          border-collapse: collapse;
          min-width: 800px;
      }

      .data-table th,
      .data-table td {
          padding: 12px;
          text-align: left;
          border-bottom: 1px solid #dee2e6;
          vertical-align: top;
      }

      .data-table th {
          background: #f8f9fa;
          font-weight: 600;
          color: #2c3e50;
          position: sticky;
          top: 0;
          z-index: 10;
      }

      .data-table tr:hover {
          background: #f8f9fa;
      }

      .description-cell {
          max-width: 300px;
          word-wrap: break-word;
          white-space: pre-wrap;
      }

      .url-cell {
          max-width: 200px;
          word-break: break-all;
      }

      .checkpoint-section {
          background: #e8f4f8;
          border: 1px solid #bee5eb;
          border-radius: 8px;
          padding: 20px;
          margin: 20px 0;
      }

      .checkpoint-info {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 15px;
      }

      .filter-section {
          background: #fff;
          border: 1px solid #dee2e6;
          border-radius: 8px;
          padding: 20px;
          margin: 20px 0;
      }

      .filter-row {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 15px;
          margin-bottom: 15px;
      }

      @media (max-width: 768px) {
          .form-row, .form-row-3 {
              grid-template-columns: 1fr;
          }
          
          .header h1 {
              font-size: 2em;
          }
          
          .main-content {
              padding: 20px;
          }

          .data-table {
              font-size: 14px;
          }

          .data-table th,
          .data-table td {
              padding: 8px;
          }
      }

      .log-section {
          background: #2c3e50;
          color: #ecf0f1;
          border-radius: 8px;
          padding: 20px;
          margin-top: 20px;
          max-height: 300px;
          overflow-y: auto;
          font-family: 'Courier New', monospace;
          font-size: 14px;
      }

      .log-entry {
          margin-bottom: 5px;
          padding: 5px;
          border-radius: 3px;
      }

      .log-info { background: rgba(52, 152, 219, 0.2); }
      .log-success { background: rgba(39, 174, 96, 0.2); }
      .log-error { background: rgba(231, 76, 60, 0.2); }
      .log-warning { background: rgba(243, 156, 18, 0.2); }
  </style>
</head>
<body>
  <div class="container">
      <div class="header">
          <h1>ğŸ•·ï¸ é«˜çº§ç½‘é¡µçˆ¬è™«å·¥å…·</h1>
          <p>æ”¯æŒæ–­ç‚¹ç»­çˆ¬ã€ç”¨æˆ·å…³æ³¨æ•°é‡ã€Channelç®€ä»‹ç­‰é«˜çº§åŠŸèƒ½</p>
      </div>

      <div class="main-content">
          <div class="input-section">
              <h2>çˆ¬è™«é…ç½®</h2>
              
              <div class="form-group">
                  <label for="url">ç›®æ ‡ç½‘å€</label>
                  <input type="url" id="url" placeholder="https://example.com" value="https://tgstat.com/tag/crypto">
              </div>

              <div class="form-row-3">
                  <div class="form-group">
                      <label for="scrapeType">çˆ¬å–ç±»å‹</label>
                      <select id="scrapeType">
                          <option value="tgstat">TGStaté¢‘é“</option>
                          <option value="telegram">Telegramé¢‘é“</option>
                          <option value="general">é€šç”¨ç½‘é¡µ</option>
                          <option value="table">è¡¨æ ¼æ•°æ®</option>
                          <option value="social">ç¤¾äº¤åª’ä½“</option>
                      </select>
                  </div>
                  
                  <div class="form-group">
                      <label for="maxPages">æœ€å¤§é¡µæ•°</label>
                      <input type="number" id="maxPages" value="10" min="1" max="100">
                  </div>

                  <div class="form-group">
                      <label for="delay">è¯·æ±‚å»¶è¿Ÿ(ç§’)</label>
                      <input type="number" id="delay" value="2" min="0.5" max="10" step="0.5">
                  </div>
              </div>

              <div class="form-group">
                  <label>æ•°æ®æå–é€‰é¡¹</label>
                  <div class="checkbox-group">
                      <div class="checkbox-item">
                          <input type="checkbox" id="extractBasicInfo" checked>
                          <label for="extractBasicInfo">åŸºæœ¬ä¿¡æ¯</label>
                      </div>
                      <div class="checkbox-item">
                          <input type="checkbox" id="extractSubscribers" checked>
                          <label for="extractSubscribers">è®¢é˜…è€…/å…³æ³¨æ•°</label>
                      </div>
                      <div class="checkbox-item">
                          <input type="checkbox" id="extractDescription" checked>
                          <label for="extractDescription">é¢‘é“ç®€ä»‹</label>
                      </div>
                      <div class="checkbox-item">
                          <input type="checkbox" id="extractActivity" checked>
                          <label for="extractActivity">æ´»è·ƒåº¦ä¿¡æ¯</label>
                      </div>
                      <div class="checkbox-item">
                          <input type="checkbox" id="extractLinks" checked>
                          <label for="extractLinks">ç›¸å…³é“¾æ¥</label>
                      </div>
                      <div class="checkbox-item">
                          <input type="checkbox" id="extractMetadata">
                          <label for="extractMetadata">å…ƒæ•°æ®</label>
                      </div>
                  </div>
              </div>

              <div class="form-row">
                  <div class="form-group">
                      <label for="outputFormat">è¾“å‡ºæ ¼å¼</label>
                      <select id="outputFormat">
                          <option value="json">JSON</option>
                          <option value="csv">CSV</option>
                          <option value="excel">Excel</option>
                          <option value="xml">XML</option>
                      </select>
                  </div>
                  
                  <div class="form-group">
                      <label for="concurrency">å¹¶å‘æ•°</label>
                      <input type="number" id="concurrency" value="3" min="1" max="10">
                  </div>
              </div>

              <div class="form-group">
                  <label for="customSelectors">è‡ªå®šä¹‰é€‰æ‹©å™¨ (å¯é€‰)</label>
                  <textarea id="customSelectors" rows="3" placeholder="JSONæ ¼å¼: {&quot;title&quot;: &quot;.channel-title&quot;, &quot;subscribers&quot;: &quot;.subscribers-count&quot;}"></textarea>
              </div>

              <div class="checkpoint-section">
                  <div class="checkpoint-info">
                      <h3>æ–­ç‚¹ç»­çˆ¬</h3>
                      <span id="checkpointStatus">æ— ä¿å­˜ç‚¹</span>
                  </div>
                  <div class="form-group">
                      <button class="btn btn-success" onclick="loadCheckpoint()" id="loadCheckpointBtn" disabled>ğŸ“‚ åŠ è½½æ–­ç‚¹</button>
                      <button class="btn btn-warning" onclick="saveCheckpoint()" id="saveCheckpointBtn" disabled>ğŸ’¾ ä¿å­˜æ–­ç‚¹</button>
                      <button class="btn btn-secondary" onclick="clearCheckpoint()">ğŸ—‘ï¸ æ¸…é™¤æ–­ç‚¹</button>
                  </div>
              </div>

              <div class="form-group">
                  <button class="btn" onclick="startScraping()" id="startBtn">ğŸš€ å¼€å§‹çˆ¬å–</button>
                  <button class="btn btn-secondary" onclick="pauseScraping()" id="pauseBtn" disabled>â¸ï¸ æš‚åœ</button>
                  <button class="btn btn-success" onclick="resumeScraping()" id="resumeBtn" disabled>â–¶ï¸ ç»§ç»­</button>
                  <button class="btn btn-danger" onclick="stopScraping()" id="stopBtn" disabled>â¹ï¸ åœæ­¢</button>
              </div>
          </div>

          <div class="results-section">
              <h2>çˆ¬å–ç»“æœ</h2>
              
              <div id="status" class="status" style="display: none;">
                  å‡†å¤‡å¼€å§‹çˆ¬å–...
              </div>

              <div class="progress-container">
                  <div class="progress-text">
                      <span id="progressText">ç­‰å¾…å¼€å§‹...</span>
                      <span id="progressPercentage">0%</span>
                  </div>
                  <div class="progress-bar">
                      <div class="progress-fill" id="progressFill"></div>
                  </div>
              </div>

              <div class="stats">
                  <div class="stat-card">
                      <div class="stat-number" id="totalItems">0</div>
                      <div class="stat-label">æ€»æ¡ç›®æ•°</div>
                  </div>
                  <div class="stat-card">
                      <div class="stat-number" id="currentPage">0</div>
                      <div class="stat-label">å½“å‰é¡µé¢</div>
                  </div>
                  <div class="stat-card">
                      <div class="stat-number" id="successRate">0%</div>
                      <div class="stat-label">æˆåŠŸç‡</div>
                  </div>
                  <div class="stat-card">
                      <div class="stat-number" id="timeElapsed">0s</div>
                      <div class="stat-label">è€—æ—¶</div>
                  </div>
                  <div class="stat-card">
                      <div class="stat-number" id="errorCount">0</div>
                      <div class="stat-label">é”™è¯¯æ•°</div>
                  </div>
                  <div class="stat-card">
                      <div class="stat-number" id="avgSubscribers">0</div>
                      <div class="stat-label">å¹³å‡å…³æ³¨æ•°</div>
                  </div>
              </div>

              <div class="filter-section">
                  <h3>æ•°æ®ç­›é€‰</h3>
                  <div class="filter-row">
                      <div class="form-group">
                          <label for="filterName">æŒ‰åç§°ç­›é€‰</label>
                          <input type="text" id="filterName" placeholder="è¾“å…¥å…³é”®è¯">
                      </div>
                      <div class="form-group">
                          <label for="filterMinSubscribers">æœ€å°å…³æ³¨æ•°</label>
                          <input type="number" id="filterMinSubscribers" placeholder="0">
                      </div>
                      <div class="form-group">
                          <label for="filterMaxSubscribers">æœ€å¤§å…³æ³¨æ•°</label>
                          <input type="number" id="filterMaxSubscribers" placeholder="æ— é™åˆ¶">
                      </div>
                      <div class="form-group">
                          <button class="btn" onclick="applyFilters()">ğŸ” åº”ç”¨ç­›é€‰</button>
                          <button class="btn btn-secondary" onclick="clearFilters()">ğŸ”„ æ¸…é™¤ç­›é€‰</button>
                      </div>
                  </div>
              </div>

              <div class="data-preview">
                  <table class="data-table" id="dataTable">
                      <thead>
                          <tr>
                              <th>åºå·</th>
                              <th>é¢‘é“åç§°</th>
                              <th>ç”¨æˆ·å</th>
                              <th>å…³æ³¨æ•°</th>
                              <th>æ´»è·ƒåº¦</th>
                              <th>ç®€ä»‹</th>
                              <th>é“¾æ¥</th>
                              <th>çŠ¶æ€</th>
                          </tr>
                      </thead>
                      <tbody id="dataTableBody">
                          <tr>
                              <td colspan="8" style="text-align: center; color: #7f8c8d; padding: 40px;">
                                  æš‚æ— æ•°æ®ï¼Œç‚¹å‡»"å¼€å§‹çˆ¬å–"å¼€å§‹å·¥ä½œ
                              </td>
                          </tr>
                      </tbody>
                  </table>
              </div>

              <div class="form-group" style="margin-top: 20px;">
                  <button class="btn" onclick="downloadData()" id="downloadBtn" disabled>ğŸ“¥ ä¸‹è½½æ•°æ®</button>
                  <button class="btn btn-secondary" onclick="previewData()">ğŸ‘ï¸ é¢„è§ˆæ•°æ®</button>
                  <button class="btn btn-secondary" onclick="exportFiltered()">ğŸ“Š å¯¼å‡ºç­›é€‰ç»“æœ</button>
                  <button class="btn btn-secondary" onclick="clearData()">ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®</button>
                  <button class="btn btn-secondary" onclick="toggleLog()">ğŸ“‹ æ˜¾ç¤ºæ—¥å¿—</button>
              </div>

              <div class="log-section" id="logSection" style="display: none;">
                  <h3>çˆ¬å–æ—¥å¿—</h3>
                  <div id="logContainer"></div>
              </div>
          </div>
      </div>
  </div>

  <script>
      let scrapingData = [];
      let filteredData = [];
      let isScrapingActive = false;
      let isPaused = false;
      let currentPageNum = 0;
      let startTime = null;
      let timerInterval = null;
      let errorCount = 0;
      let checkpointData = null;

      // å¢å¼ºçš„æ¨¡æ‹Ÿæ•°æ®
      const enhancedSampleData = [
          { 
              name: "Hamster Kombat", 
              username: "@hamster_kombat", 
              subscribers: 53200000,
              subscribersText: "53.2M",
              activity: "12å°æ—¶å‰",
              description: "ğŸ¹ Hamster Kombat - æœ€å—æ¬¢è¿çš„Telegramæ¸¸æˆï¼åŠ å…¥æˆ‘ä»¬çš„ä»“é¼ CEOä¸–ç•Œï¼Œé€šè¿‡ç‚¹å‡»å’Œå‡çº§æ¥å»ºç«‹ä½ çš„åŠ å¯†è´§å¸å¸å›½ã€‚æ¯å¤©éƒ½æœ‰æ–°çš„ä»»åŠ¡å’Œå¥–åŠ±ç­‰ç€ä½ ï¼",
              url: "https://t.me/hamster_kombat",
              category: "æ¸¸æˆ",
              verified: true
          },
          { 
              name: "Blum", 
              username: "@blumcrypto", 
              subscribers: 24100000,
              subscribersText: "24.1M",
              activity: "6å°æ—¶å‰",
              description: "ğŸ’ Blum - ä½ çš„ä¸€ç«™å¼åŠ å¯†è´§å¸äº¤æ˜“åº”ç”¨ã€‚è½»æ¾è´­ä¹°ã€äº¤æ˜“å¸‚åœºä¸Šçš„ä»»ä½•åŠ å¯†è´§å¸ã€‚ç®€å•ã€æœ‰è¶£çš„åŠ å¯†è´§å¸äº¤æ˜“ä½“éªŒï¼Œé€‚åˆæ‰€æœ‰ç”¨æˆ·ã€‚",
              url: "https://t.me/blumcrypto",
              category: "äº¤æ˜“",
              verified: true
          },
          { 
              name: "Major", 
              username: "@majors", 
              subscribers: 18700000,
              subscribersText: "18.7M",
              activity: "2å¤©å‰",
              description: "â­ Major Community - åœ¨è¯„çº§ä¸­è·å¾—æ›´é«˜æ’åï¼Œç°åœ¨å°±æˆä¸ºTelegramçš„Majorï¼å‚ä¸ç¤¾åŒºæ´»åŠ¨ï¼Œèµ¢å–ç‹¬å®¶å¥–åŠ±å’Œç‰¹æƒã€‚",
              url: "https://t.me/majors",
              category: "ç¤¾åŒº",
              verified: true
          },
          { 
              name: "TapSwap", 
              username: "@tapswapai", 
              subscribers: 16700000,
              subscribersText: "16.7M",
              activity: "1å¤©å‰",
              description: "ğŸš€ TapSwap - å°†ä½ çš„æ— å°½ç‚¹å‡»è½¬åŒ–ä¸ºé‡‘èå·¥å…·ã€‚åˆ›æ–°çš„ç‚¹å‡»æŒ–çŸ¿æ¸¸æˆï¼Œè®©æ¯ä¸€æ¬¡ç‚¹å‡»éƒ½æœ‰ä»·å€¼ã€‚åŠ å…¥æ•°ç™¾ä¸‡ç”¨æˆ·çš„è¡Œåˆ—ï¼",
              url: "https://t.me/tapswapai",
              category: "æŒ–çŸ¿",
              verified: true
          },
          { 
              name: "X Empire", 
              username: "@x_empire_holders", 
              subscribers: 14500000,
              subscribersText: "14.5M",
              activity: "18å°æ—¶å‰",
              description: "ğŸ‘‘ X Empire - æ¬¢è¿æ¥åˆ°å®˜æ–¹X Empireé¢‘é“ï¼å»ºç«‹ä½ çš„å•†ä¸šå¸å›½ï¼ŒæŠ•èµ„è‚¡ç¥¨ï¼Œæˆä¸ºäº¿ä¸‡å¯Œç¿ã€‚ç­–ç•¥ä¸è¿æ°”çš„å®Œç¾ç»“åˆã€‚",
              url: "https://t.me/x_empire_holders",
              category: "ç­–ç•¥",
              verified: true
          }
      ];

      function log(message, type = 'info') {
          const timestamp = new Date().toLocaleTimeString();
          const logContainer = document.getElementById('logContainer');
          const logEntry = document.createElement('div');
          logEntry.className = `log-entry log-${type}`;
          logEntry.textContent = `[${timestamp}] ${message}`;
          logContainer.appendChild(logEntry);
          logContainer.scrollTop = logContainer.scrollHeight;
      }

      function updateStatus(message, type = 'loading') {
          const statusEl = document.getElementById('status');
          statusEl.textContent = message;
          statusEl.className = `status ${type}`;
          statusEl.style.display = 'block';
          log(message, type === 'loading' ? 'info' : type);
      }

      function updateProgress(percentage, text = '') {
          document.getElementById('progressFill').style.width = percentage + '%';
          document.getElementById('progressPercentage').textContent = Math.round(percentage) + '%';
          if (text) {
              document.getElementById('progressText').textContent = text;
          }
      }

      function updateStats(items, page, success, time, errors, avgSubs) {
          document.getElementById('totalItems').textContent = items.toLocaleString();
          document.getElementById('currentPage').textContent = page;
          document.getElementById('successRate').textContent = success + '%';
          document.getElementById('timeElapsed').textContent = time + 's';
          document.getElementById('errorCount').textContent = errors;
          document.getElementById('avgSubscribers').textContent = avgSubs > 1000000 ? 
              (avgSubs / 1000000).toFixed(1) + 'M' : 
              avgSubs > 1000 ? (avgSubs / 1000).toFixed(1) + 'K' : avgSubs;
      }

      function addDataRow(index, item) {
          const tbody = document.getElementById('dataTableBody');
          if (index === 0) {
              tbody.innerHTML = '';
          }
          
          const row = tbody.insertRow();
          const statusIcon = item.verified ? 'âœ… å·²éªŒè¯' : 'âšª æ™®é€š';
          const description = item.description ? 
              (item.description.length > 100 ? item.description.substring(0, 100) + '...' : item.description) : 
              'æ— ç®€ä»‹';
          
          row.innerHTML = `
              <td>${index + 1}</td>
              <td><strong>${item.name || 'æœªçŸ¥'}</strong><br><small>${item.category || 'æœªåˆ†ç±»'}</small></td>
              <td><code>${item.username || 'æ— ç”¨æˆ·å'}</code></td>
              <td><strong>${item.subscribersText || item.subscribers?.toLocaleString() || '0'}</strong></td>
              <td>${item.activity || 'æœªçŸ¥'}</td>
              <td class="description-cell">${description}</td>
              <td class="url-cell"><a href="${item.url}" target="_blank">è®¿é—®</a></td>
              <td>${statusIcon}</td>
          `;
      }

      function saveCheckpoint() {
          checkpointData = {
              data: [...scrapingData],
              currentPage: currentPageNum,
              timestamp: Date.now(),
              config: {
                  url: document.getElementById('url').value,
                  maxPages: document.getElementById('maxPages').value,
                  scrapeType: document.getElementById('scrapeType').value
              }
          };
          
          localStorage.setItem('scraperCheckpoint', JSON.stringify(checkpointData));
          document.getElementById('checkpointStatus').textContent = `å·²ä¿å­˜ (${new Date().toLocaleString()})`;
          document.getElementById('loadCheckpointBtn').disabled = false;
          updateStatus('æ–­ç‚¹å·²ä¿å­˜', 'success');
          log('æ–­ç‚¹æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨', 'success');
      }

      function loadCheckpoint() {
          const saved = localStorage.getItem('scraperCheckpoint');
          if (saved) {
              checkpointData = JSON.parse(saved);
              scrapingData = [...checkpointData.data];
              currentPageNum = checkpointData.currentPage;
              
              // æ¢å¤é…ç½®
              document.getElementById('url').value = checkpointData.config.url;
              document.getElementById('maxPages').value = checkpointData.config.maxPages;
              document.getElementById('scrapeType').value = checkpointData.config.scrapeType;
              
              // é‡æ–°æ˜¾ç¤ºæ•°æ®
              refreshDataTable();
              updateStats(scrapingData.length, currentPageNum, 95, 0, errorCount, calculateAvgSubscribers());
              
              updateStatus(`å·²åŠ è½½æ–­ç‚¹æ•°æ® (${scrapingData.length}æ¡è®°å½•)`, 'success');
              log(`ä»æ–­ç‚¹æ¢å¤ ${scrapingData.length} æ¡æ•°æ®`, 'success');
              document.getElementById('downloadBtn').disabled = false;
          }
      }

      function clearCheckpoint() {
          localStorage.removeItem('scraperCheckpoint');
          checkpointData = null;
          document.getElementById('checkpointStatus').textContent = 'æ— ä¿å­˜ç‚¹';
          document.getElementById('loadCheckpointBtn').disabled = true;
          updateStatus('æ–­ç‚¹å·²æ¸…é™¤', 'success');
          log('æ–­ç‚¹æ•°æ®å·²æ¸…é™¤', 'info');
      }

      function calculateAvgSubscribers() {
          if (scrapingData.length === 0) return 0;
          const total = scrapingData.reduce((sum, item) => sum + (item.subscribers || 0), 0);
          return Math.round(total / scrapingData.length);
      }

              function refreshDataTable() {
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = '';
            
            if (filteredData.length === 0 && scrapingData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; color: #7f8c8d; padding: 40px;">
                            æš‚æ— æ•°æ®ï¼Œç‚¹å‡»"å¼€å§‹çˆ¬å–"å¼€å§‹å·¥ä½œ
                        </td>
                    </tr>
                `;
                return;
            }
            
            const dataToShow = filteredData.length > 0 ? filteredData : scrapingData;
            dataToShow.forEach((item, index) => {
                addDataRow(index, item);
            });
        }

        function startScraping() {
            if (isScrapingActive) return;
            
            isScrapingActive = true;
            isPaused = false;
            errorCount = 0;
            
            // å¦‚æœä¸æ˜¯ä»æ–­ç‚¹æ¢å¤ï¼Œæ¸…ç©ºæ•°æ®
            if (!checkpointData || currentPageNum === 0) {
                scrapingData = [];
                currentPageNum = 0;
            }
            
            startTime = Date.now();
            
            updateStatus('æ­£åœ¨åˆå§‹åŒ–çˆ¬è™«...', 'loading');
            updateProgress(0, 'å‡†å¤‡å¼€å§‹çˆ¬å–...');
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('saveCheckpointBtn').disabled = false;
            
            // å¼€å§‹è®¡æ—¶å™¨
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                updateStats(scrapingData.length, currentPageNum, 95, elapsed, errorCount, calculateAvgSubscribers());
            }, 1000);
            
            log('å¼€å§‹çˆ¬å–ä»»åŠ¡', 'info');
            simulateScraping();
        }

        function simulateScraping() {
            const maxPages = parseInt(document.getElementById('maxPages').value);
            const delay = parseFloat(document.getElementById('delay').value) * 1000;
            const concurrency = parseInt(document.getElementById('concurrency').value);
            
            function scrapePage(pageNum) {
                if (!isScrapingActive || pageNum >= maxPages) {
                    completeScraping();
                    return;
                }
                
                if (isPaused) {
                    updateStatus('çˆ¬å–å·²æš‚åœï¼Œç‚¹å‡»ç»§ç»­æŒ‰é’®æ¢å¤', 'paused');
                    return;
                }
                
                currentPageNum = pageNum + 1;
                const progressPercent = (currentPageNum / maxPages) * 100;
                updateStatus(`æ­£åœ¨çˆ¬å–ç¬¬ ${currentPageNum} é¡µ...`, 'loading');
                updateProgress(progressPercent, `å¤„ç†ç¬¬ ${currentPageNum}/${maxPages} é¡µ`);
                
                log(`å¼€å§‹çˆ¬å–ç¬¬ ${currentPageNum} é¡µ`, 'info');
                
                setTimeout(() => {
                    // æ¨¡æ‹Ÿå¯èƒ½çš„é”™è¯¯
                    if (Math.random() < 0.1) {
                        errorCount++;
                        log(`ç¬¬ ${currentPageNum} é¡µçˆ¬å–å¤±è´¥: ç½‘ç»œè¶…æ—¶`, 'error');
                    }
                    
                    // æ·»åŠ æ¨¡æ‹Ÿæ•°æ®
                    const pageData = enhancedSampleData.map((item, index) => ({
                        ...item,
                        name: item.name + ` (P${currentPageNum})`,
                        id: scrapingData.length + index,
                        subscribers: item.subscribers + Math.floor(Math.random() * 100000),
                        subscribersText: formatSubscribers(item.subscribers + Math.floor(Math.random() * 100000)),
                        activity: getRandomActivity(),
                        extractedAt: new Date().toISOString()
                    }));
                    
                    pageData.forEach((item, index) => {
                        scrapingData.push(item);
                        addDataRow(scrapingData.length - 1, item);
                        log(`æå–æ•°æ®: ${item.name} - ${item.subscribersText} å…³æ³¨è€…`, 'success');
                    });
                    
                    // è‡ªåŠ¨ä¿å­˜æ–­ç‚¹
                    if (currentPageNum % 5 === 0) {
                        saveCheckpoint();
                    }
                    
                    scrapePage(pageNum + 1);
                }, delay);
            }
            
            scrapePage(currentPageNum);
        }

        function formatSubscribers(count) {
            if (count >= 1000000) {
                return (count / 1000000).toFixed(1) + 'M';
            } else if (count >= 1000) {
                return (count / 1000).toFixed(1) + 'K';
            }
            return count.toString();
        }

        function getRandomActivity() {
            const activities = ['åˆšåˆš', '5åˆ†é’Ÿå‰', '1å°æ—¶å‰', '6å°æ—¶å‰', '12å°æ—¶å‰', '1å¤©å‰', '2å¤©å‰', '1å‘¨å‰'];
            return activities[Math.floor(Math.random() * activities.length)];
        }

        function pauseScraping() {
            if (isScrapingActive && !isPaused) {
                isPaused = true;
                updateStatus('çˆ¬å–å·²æš‚åœ', 'paused');
                document.getElementById('pauseBtn').disabled = true;
                document.getElementById('resumeBtn').disabled = false;
                log('çˆ¬å–ä»»åŠ¡å·²æš‚åœ', 'warning');
            }
        }

        function resumeScraping() {
            if (isScrapingActive && isPaused) {
                isPaused = false;
                document.getElementById('pauseBtn').disabled = false;
                document.getElementById('resumeBtn').disabled = true;
                log('çˆ¬å–ä»»åŠ¡å·²æ¢å¤', 'info');
                simulateScraping();
            }
        }

        function stopScraping() {
            isScrapingActive = false;
            isPaused = false;
            clearInterval(timerInterval);
            
            updateStatus('çˆ¬å–å·²åœæ­¢', 'error');
            updateProgress(0, 'å·²åœæ­¢');
            
            // é‡ç½®æŒ‰é’®çŠ¶æ€
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('resumeBtn').disabled = true;
            document.getElementById('stopBtn').disabled = true;
            
            log('çˆ¬å–ä»»åŠ¡å·²åœæ­¢', 'warning');
        }

        function completeScraping() {
            isScrapingActive = false;
            isPaused = false;
            clearInterval(timerInterval);
            
            updateStatus(`çˆ¬å–å®Œæˆï¼å…±è·å– ${scrapingData.length} æ¡æ•°æ®`, 'success');
            updateProgress(100, 'çˆ¬å–å®Œæˆ');
            
            // é‡ç½®æŒ‰é’®çŠ¶æ€
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('resumeBtn').disabled = true;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('downloadBtn').disabled = false;
            
            log(`çˆ¬å–ä»»åŠ¡å®Œæˆï¼Œå…±è·å– ${scrapingData.length} æ¡æ•°æ®`, 'success');
            
            // æ¸…é™¤æ–­ç‚¹
            clearCheckpoint();
        }

        function applyFilters() {
            const nameFilter = document.getElementById('filterName').value.toLowerCase();
            const minSubs = parseInt(document.getElementById('filterMinSubscribers').value) || 0;
            const maxSubs = parseInt(document.getElementById('filterMaxSubscribers').value) || Infinity;
            
            filteredData = scrapingData.filter(item => {
                const nameMatch = !nameFilter || item.name.toLowerCase().includes(nameFilter) || 
                                 item.username.toLowerCase().includes(nameFilter);
                const subsMatch = item.subscribers >= minSubs && item.subscribers <= maxSubs;
                return nameMatch && subsMatch;
            });
            
            refreshDataTable();
            log(`åº”ç”¨ç­›é€‰æ¡ä»¶ï¼Œæ˜¾ç¤º ${filteredData.length}/${scrapingData.length} æ¡æ•°æ®`, 'info');
        }

        function clearFilters() {
            document.getElementById('filterName').value = '';
            document.getElementById('filterMinSubscribers').value = '';
            document.getElementById('filterMaxSubscribers').value = '';
            filteredData = [];
            refreshDataTable();
            log('å·²æ¸…é™¤æ‰€æœ‰ç­›é€‰æ¡ä»¶', 'info');
        }

        function downloadData() {
            const dataToDownload = filteredData.length > 0 ? filteredData : scrapingData;
            if (dataToDownload.length === 0) {
                alert('æ²¡æœ‰æ•°æ®å¯ä¸‹è½½');
                return;
            }
            
            const format = document.getElementById('outputFormat').value;
            let content, filename, mimeType;
            
            switch (format) {
                case 'json':
                    content = JSON.stringify(dataToDownload, null, 2);
                    filename = 'scraped_data.json';
                    mimeType = 'application/json';
                    break;
                case 'csv':
                    const headers = ['åºå·', 'é¢‘é“åç§°', 'ç”¨æˆ·å', 'å…³æ³¨æ•°', 'æ´»è·ƒåº¦', 'ç®€ä»‹', 'é“¾æ¥', 'åˆ†ç±»', 'éªŒè¯çŠ¶æ€'].join(',');
                    const rows = dataToDownload.map((item, index) => [
                        index + 1,
                        `"${item.name || ''}"`,
                        `"${item.username || ''}"`,
                        item.subscribers || 0,
                        `"${item.activity || ''}"`,
                        `"${(item.description || '').replace(/"/g, '""')}"`,
                        `"${item.url || ''}"`,
                        `"${item.category || ''}"`,
                        item.verified ? 'å·²éªŒè¯' : 'æ™®é€š'
                    ].join(','));
                    content = headers + '\n' + rows.join('\n');
                    filename = 'scraped_data.csv';
                    mimeType = 'text/csv;charset=utf-8';
                    break;
                case 'xml':
                    content = '<?xml version="1.0" encoding="UTF-8"?>\n<channels>\n';
                    dataToDownload.forEach(item => {
                        content += '  <channel>\n';
                        content += `    <name><![CDATA[${item.name || ''}]]></name>\n`;
                        content += `    <username><![CDATA[${item.username || ''}]]></username>\n`;
                        content += `    <subscribers>${item.subscribers || 0}</subscribers>\n`;
                        content += `    <activity><![CDATA[${item.activity || ''}]]></activity>\n`;
                        content += `    <description><![CDATA[${item.description || ''}]]></description>\n`;
                        content += `    <url><![CDATA[${item.url || ''}]]></url>\n`;
                        content += `    <category><![CDATA[${item.category || ''}]]></category>\n`;
                        content += `    <verified>${item.verified || false}</verified>\n`;
                        content += '  </channel>\n';
                    });
                    content += '</channels>';
                    filename = 'scraped_data.xml';
                    mimeType = 'application/xml';
                    break;
                default:
                    content = JSON.stringify(dataToDownload, null, 2);
                    filename = 'scraped_data.json';
                    mimeType = 'application/json';
            }
            
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            log(`æ•°æ®å·²ä¸‹è½½: ${filename} (${dataToDownload.length} æ¡è®°å½•)`, 'success');
        }

        function exportFiltered() {
            if (filteredData.length === 0) {
                alert('æ²¡æœ‰ç­›é€‰æ•°æ®å¯å¯¼å‡ºï¼Œè¯·å…ˆåº”ç”¨ç­›é€‰æ¡ä»¶');
                return;
            }
            downloadData();
        }

        function previewData() {
            const dataToPreview = filteredData.length > 0 ? filteredData : scrapingData;
            if (dataToPreview.length === 0) {
                alert('æ²¡æœ‰æ•°æ®å¯é¢„è§ˆ');
                return;
            }
            
            const preview = JSON.stringify(dataToPreview.slice(0, 3), null, 2);
            alert(`æ•°æ®é¢„è§ˆï¼ˆå‰3æ¡ï¼‰:\n\n${preview}`);
        }

        function clearData() {
            scrapingData = [];
            filteredData = [];
            currentPageNum = 0;
            errorCount = 0;
            
            refreshDataTable();
            updateStats(0, 0, 0, 0, 0, 0);
            updateProgress(0, 'å·²æ¸…ç©º');
            updateStatus('æ•°æ®å·²æ¸…ç©º', 'success');
            document.getElementById('downloadBtn').disabled = true;
            
            log('æ‰€æœ‰æ•°æ®å·²æ¸…ç©º', 'info');
        }

        function toggleLog() {
            const logSection = document.getElementById('logSection');
            const isVisible = logSection.style.display !== 'none';
            logSection.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                log('æ—¥å¿—é¢æ¿å·²æ‰“å¼€', 'info');
            }
        }

        // åˆå§‹åŒ–æ£€æŸ¥æ–­ç‚¹
        document.addEventListener('DOMContentLoaded', function() {
            const saved = localStorage.getItem('scraperCheckpoint');
            if (saved) {
                const checkpoint = JSON.parse(saved);
                document.getElementById('checkpointStatus').textContent = 
                    `æœ‰ä¿å­˜ç‚¹ (${new Date(checkpoint.timestamp).toLocaleString()})`;
                document.getElementById('loadCheckpointBtn').disabled = false;
            }
            
            log('çˆ¬è™«å·¥å…·å·²åˆå§‹åŒ–', 'info');
        });

        // æ ¹æ®çˆ¬å–ç±»å‹æ›´æ–°ç•Œé¢
        document.getElementById('scrapeType').addEventListener('change', function() {
            const type = this.value;
            const urlInput = document.getElementById('url');
            
            switch (type) {
                case 'tgstat':
                    urlInput.value = 'https://tgstat.com/tag/crypto';
                    break;
                case 'telegram':
                    urlInput.value = 'https://t.me/s/';
                    break;
                case 'general':
                    urlInput.value = 'https://example.com';
                    break;
                case 'social':
                    urlInput.value = 'https://twitter.com/search?q=crypto';
                    break;
                default:
                    urlInput.value = 'https://example.com';
            }
            
            log(`åˆ‡æ¢çˆ¬å–ç±»å‹: ${type}`, 'info');
        });

        // å®æ—¶ç­›é€‰
        ['filterName', 'filterMinSubscribers', 'filterMaxSubscribers'].forEach(id => {
            document.getElementById(id).addEventListener('input', function() {
                if (scrapingData.length > 0) {
                    setTimeout(applyFilters, 300);
                }
            });
        });
    </script>
</body>
</html>
